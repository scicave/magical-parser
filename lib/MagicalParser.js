/*!
 * 
 * magical-parser v1.0.0       Tue Jul 14 2020 17:23:51 GMT+0200 (Eastern European Standard Time)
 * by Mohammed Samir       ms.2052001@gmail.com
 * https://github.com/scicave/magical-parser#readme
 * 
 * Copyright: 2020 NTNU;
 * License: Apache
 * 
 * Build: 43d15452f350152fe87c
 *    
 */
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.MagicalParser=n():e.MagicalParser=n()}(window,(function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){var r=t(1).default;e.exports=r},function(e,n,t){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a(e,n){return!n||"object"!==r(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function i(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&l(e,n)}function u(e){var n="function"==typeof Map?new Map:void 0;return(u=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return c(e,arguments,f(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,e)})(e)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e,n,t){return(c=s()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(e,r));return t&&l(o,t.prototype),o}).apply(null,arguments)}function l(e,n){return(l=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}t.r(n);var p=function(e){function n(e,t){var r;return o(this,n),(r=a(this,f(n).call(this,e))).position=t,r.messsege=e,r}return i(n,e),n}(u(Error)),h=function(e){function n(e,t){var r;return o(this,n),(r=a(this,f(n).call(this,e))).position=t,r.messsege=e,r}return i(n,e),n}(u(Error)),g=function(e){function n(e,t){var r;return o(this,n),(r=a(this,f(n).call(this,e))).position=t,r.messsege=e,r}return i(n,e),n}(u(Error));function d(e){return e.replace(/[+*/.$^(){|}[\]]/g,(function(e){return"\\"+e}))}var v={symbols:"!\"'#$%&()*+,-./:;<=>?@[\\]^_`{|}~€‚„…†‡ˆ‰‹‘’“”•–—˜™›¡¢£¤¥¦§¨©«¬®¯°±²³´¶·¸¹º»¼½¾¿×÷",isSymbol:function(e){return/(?:[$+<->^`|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20BF\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B98-\u2BFF\u2CE5-\u2CEA\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uFB29\uFBB2-\uFBC1\uFDFC\uFDFD\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9B\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDE8\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD10-\uDD6C\uDD70-\uDDAC\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED5\uDEE0-\uDEEC\uDEF0-\uDEFA\uDF00-\uDF73\uDF80-\uDFD8\uDFE0-\uDFEB]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDD00-\uDD0B\uDD0D-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDE53\uDE60-\uDE6D\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])/.test(e)},isEmoji:function(e){return/(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5\uDEEB\uDEEC\uDEF4-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])/.test(e)},isWhiteSpace:function(e){return/[\t-\r \x85\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/.test(e)},isNum:function(e){return!isNaN(e)},isAlpha:function(e){return!isNaN(e)&&!v.isSymbol(e)},spaced:function(e){return!v.isSymbol(e)},isVarName:function(e){var n=this;e.replace(/^\s*(.*)\d*\s*$/,(function(e,t){var r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var s=i.value;n.isAlpha(s)||"_"===s}}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}}))},check:function(e,n){switch(n){case"name":return this.isVarName(e);case"num":return!isNaN(e);case"all":return!0;default:return n instanceof RegExp?n.test(e):(console.log('checking test "'.concat(n,'" is not supported.')),!0)}}};function m(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;switch(n=n+(t=""===(t=t||"")?"":"\n"+t+"\n")+(r=isNaN(r)?r?"position: ".concat(r):"":new Array(r).fill("_").join("")+"^"),e){case"forbiddenChars":throw new p(n);case"operators":throw new h(n);case"blocks":throw new g(n);default:throw new Error(n)}}function y(e,n){return e.indexOf(n)>-1}function D(){return D.operationBlockChar+(Date.now()+D.randomNameNum++).toString(36)+D.operationBlockChar}D.randomNameNum=0,D.operationBlockChar="¶";var b=["¶"];function w(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function x(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(n,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(w(this,e),o.name=o.name||n,Object.assign(this,Object.assign(o,this)),this.childrenNum=t,r.length!==t&&t>-1)throw Error("rules num in "+(this.name+" "||!1)+"must be "+this.rulesNum);var a=!0,i=!1,u=void 0;try{for(var s,c=r[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;l.parentRule=this}}catch(e){i=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw u}}this.childrenRules=r}var n,t,r;return n=e,(t=[{key:"getRegex",value:function(e){return""}},{key:"parse",value:function(e,n){throw new Error("You mustn't call this function directly from the abstract class Rule.")}},{key:"getBlocksInside",value:function(){if(this instanceof A)return[rule];var e=[],n=!0,t=!1,r=void 0;try{for(var o,a=this.children[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var i=o.value;e.concat(i.getBlocksInside())}}catch(e){t=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}return e}}])&&x(n.prototype,t),r&&x(n,r),e}();function F(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function O(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};F(this,e),Object.assign(this,r),this.args=t instanceof Array?t:[t],this.type=n}var n,t,r;return n=e,(t=[{key:"check",value:function(e){for(var n in arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.args.length,e)if(this[n]!==e[n])return!1;return!0}},{key:"contains",value:function(e){if(this.check(e))return!0;if(this.args)for(var n=0;n<this.args.length;n++)if(this.args[n].contains(e))return!0;return!1}},{key:"isLiteral",get:function(){return"literal"===this.type}}])&&O(n.prototype,t),r&&O(n,r),e}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,n){return!n||"object"!==_(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,n){return(S=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var A=function(e){function n(e){var t;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),e.opening=e.opening instanceof RegExp?e.opening.source:d(e.opening),e.closing=e.closing instanceof RegExp?e.closing.source:d(e.closing),!e.opening||!e.closing)throw new Error("Error on defining your block, you should define the opening and closing properties as the regex or the text");return e.opening!==e.closing&&(e.blockState=!0),e.content=e.content||"all",e.groupsNumInside=0,e.content instanceof E||(e.content instanceof RegExp?e.content=e.content.source:e.content="all"===e.content?"(?:.|\\s)*?":d(e.content),e.groupsNumInside+=function e(n){var t=0,r=n instanceof RegExp?n.source:n;if(""==r)return 0;if(""==(r=r.replace(/\\./g,"").replace(/^([^(])+/,"")))return 0;if(r.indexOf("(")>-1)for(var o=1,a=1;a<r.length;a++)if(")"==r[a]?o--:"("==r[a]&&o++,0==o){var i=r.slice(1,a);"?:"!==r.slice(1,3)&&t++,t+=e(i),t+=e(r=r.slice(a+1));break}return t||0}(e.content)),(t=T(this,k(n).call(this,"Block",0,[],e))).openingReg=new RegExp(t.opening),t.closingReg=new RegExp(t.closing),t}var t,r,o;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&S(e,n)}(n,e),t=n,(r=[{key:"getRegex",value:function(e,n){if(this.blockState&&!n)return this._blockStateToParents(),this.id=D(),e=e||{num:0,increase:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.num+=e,this}},this.realRegex=new RegExp(this.getRegex(null,!0)),this.index=e.num,this.content instanceof E&&(this.parser=new z(this.childrenRules[0])),this.rootParser.blocksRules.push(this),this.rootParser.blockState=!0,this.matchIdRegex=new RegExp("".concat(this.id).concat("¶","\\d+").concat("¶")),"(".concat(this.matchIdRegex.source,")");var t;e=e||{num:0,increase:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.num+=e,this}},this.index=e.num,this.content instanceof E?t=this.content.getRegex(e.increase()):(e.increase(this.groupsNumInside+1),t="("+this.content+")");var r="".concat(this.opening).concat(t).concat(this.closing);return this.regex=r,"(".concat(r,")")}},{key:"_blockStateToParents",value:function(){for(var e=this.parentRule;e;)e.blockState=!0,e=e.parentRule}},{key:"getMatchId",value:function(e){return this.id+"¶"+e+"¶"}},{key:"parse",value:function(e,n){if(this.blockState){var t=n||e[this.index+1],r=[],o=t.split("¶")[3];return t=this.rootParser.matches[this.id][o],this.parser&&(r=this.parser.parse(t.content)),new R(this.name,r,{match:t.str,content:t.content})}var a=n||e[this.index+1],i=[];return this.content instanceof E?i=this.content.parse(e):this.parser&&(i=this.parser.parse(a)),new R(this.name,i,{match:a,content:e[this.index+2]})}}])&&C(t.prototype,r),o&&C(t,o),n}(E);function B(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.rule=n}var n,t,r;return n=e,(t=[{key:"prepareBlocks",value:function(){this.blocks=this.rule.getBlocksInside()}},{key:"prepareRegexes",value:function(){this.regex=rule.getRegex()}},{key:"rule",get:function(){return this._rule},set:function(e){this._rule=e,this.prepareBlocks(),this.prepareRegexes()}}])&&B(n.prototype,t),r&&B(n,r),e}();function j(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(n){var t=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.grammer=n instanceof I?n:n instanceof E?new I(n):n,this.blockState=!n.blocks||0===n.blocks.length,this.matchesTest=new RegExp("(".concat("¶","\\w+").concat("¶",")").concat("¶","(\\d+)").concat("¶"),"g"),this.matches=[];!function e(n){n.rootParser=t;var r=!0,o=!1,a=void 0;try{for(var i,u=n.childrenRules[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){e(i.value)}}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}}(this.grammer),this.prepareRegex()}var n,t,r;return n=e,(t=[{key:"prepareRegex",value:function(){this.regex=new RegExp("^\\s*"+this.grammer.getRegex()+"\\s*$")}},{key:"parse",value:function(e){var n=this;if(this.regex&&e){var t;if(this.blockState){var r=!0,o=!1,a=void 0;try{for(var i,u=function(){var t=i.value,r=[];!function n(r,o){var a,i,u,s,c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=r.search(t.openingReg),p=r.search(t.closingReg);if(f>-1&&p>-1&&p>f){c=0,r.replace(t.openingReg,(function(e){c=e.length})),i=f,a=f+c,r=r.slice(a);for(var h=1;h>0;){if(f=r.search(t.openingReg),!((p=r.search(t.closingReg))>-1))throw new Error("block seams not to be closed, correct it and try again.");f>p||-1===f?h--:h++}c=0,r.slice(p).replace(t.closingReg,(function(e){c=e.length})),s=(u=a+p)+c,o.push({str:e.slice(i+l,s+l),content:e.slice(a+l,u+l),start:i+l,end:s+l,contentStart:a+l,contentEnd:u+l,realIndexes:{start:i+l,end:s+l,contentStart:a+l,contentEnd:u+l}}),""!==(r=r.slice(p+c))&&n(r,o,l+s)}}(e,r),n.matches[t.id]=r;for(var o=0;o<r.length;o++)if(t.realRegex.test(r[o].str)){var a=t.getMatchId(o);e=e.slice(0,r[o].start)+a+e.slice(r[o].end);for(var u=o+1;u<r.length;u++){var s=a.length-r[o].str.length;r[u].start+=s,r[u].end+=s,r[u].contentStart+=s,r[u].contentEnd+=s}}},s=this.blocksRules[Symbol.iterator]();!(r=(i=s.next()).done);r=!0)u()}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}}if(e.replace(this.regex,(function(){t=arguments})),!t)throw new Error("your code doesn't match");return t.pop(),t.pop(),this.grammer.parse(t)}throw new Error("Ops, there was a problem in parsing process, perhaps your string is not valid for starting parsing, or your grammer is not precise")}}])&&j(n.prototype,t),r&&j(n,r),e}();function P(e,n){return!n||"object"!==G(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&$(e,n)}function $(e,n){return($=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function q(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(n){K(this,e),n=n||{},n=Object.assign({zIndex:0},n),Object.assign(this,n)}var n,t,r;return n=e,(t=[{key:"toString",value:function(){return this.regexStr}},{key:"name",get:function(){return this._name||this._id},set:function(e){this._name=e}},{key:"id",get:function(){return this._id},set:function(e){if(!e||""===e)throw new Error("operator id can not be void or empty");this._id=e,e instanceof RegExp?this.regexStr=e.toString().slice(1,-1):this.regexStr=d(e.toString()),this.regex=new RegExp(this.regexStr),this.spaced={right:v.spaced(e[e.toString().length-1]),left:v.spaced(e[0])}}},{key:"spaced",get:function(){return this._spaced},set:function(e){this._spaced="object"===G(e)?Object.assign({},e):{right:e,left:e}}}])&&q(n.prototype,t),r&&q(n,r),e}(),Z=function(e){function n(e){return K(this,n),P(this,N(n).call(this,e))}return M(n,e),n}(U),L=function(e){function n(e){return K(this,n),P(this,N(n).call(this,e))}return M(n,e),n}(U),V=function(e){function n(e){return K(this,n),P(this,N(n).call(this,e))}return M(n,e),n}(U),Y=function(e){function n(e){return K(this,n),P(this,N(n).call(this,e))}return M(n,e),n}(U);function Q(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function W(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function H(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};W(this,e),this.options=n,this.prepareOptions(n)}var n,t,r;return n=e,(t=[{key:"prepareOptions",value:function(e){(e=Object.assign({nameTest:"[_a-zA-Z]+\\d*",numTest:"\\d*\\.?\\d+|\\d+\\.?\\d*",blocks:[],args:[],operators:[],suffixOperators:[],prefixOperators:[],separators:[],forbiddenChars:[]},e)).forbiddenChars=[].concat(Q(e.forbiddenChars),Q(specialChars));var n={operators:"",prefixOperators:"",suffixOperators:""},t=function(e){if(e&&e.length>0){for(var n=" ",t=function(t){var r=e[t],o=!1;n.replace(new RegExp("\\(@(".concat(r.regexStr,")#(\\d*)\\)")),(function(n,a,i){return Object.assign(e[t],e[parseInt(i)]),e.splice(parseInt(i),1),o=!0," (@".concat(r.toString(),",#").concat(t,") ")})),o||(n+="(@".concat(r.regexStr,"#").concat(t,")"))},r=0;r<e.length;r++)t(r);return n}};return n.operators=t(e.operators),n.prefixOperators=t(e.prefixOperators),n.suffixOperators=t(e.suffixOperators),e.all=n,(n={operators:"",prefixOperators:"",suffixOperators:""}).operators=(t=function(e){if(0==e.length)return"";if(e&&e.length>0){for(var n="",t=0;t<e.length;t++){var r=e[t];n+="".concat(r.regexStr,"|")}return n.slice(0,-1)}})(e.operators),n.prefixOperators=t(e.prefixOperators),n.suffixOperators=t(e.suffixOperators),e.allRegex=n,e.operators&&(e.operators=e.operators.sort((function(e,n){return-(e.zIndex-n.zIndex)}))),e.blocks={values:e.blocks,openedBlock:null},e.rulesRegex=[],e.rules.forEach((function(n){e.rulesRegex.push(new RegExp(n.getRegex()))})),e.nameTestReg=new RegExp(e.nameTest),e.numTestReg=new RegExp(e.numTest),e.operationTestGrouped="(?:(".concat(e.nameTest,")\\s*)?(")+operationBlockChar+e.nameTest+operationBlockChar+")",e.operationTestGroupedReg=new RegExp("^\\s*".concat(e.operationTestGrouped,"\\s*$")),e.operationTest="(?:".concat(e.nameTest,"\\s*)?")+operationBlockChar+e.nameTest+operationBlockChar,e.operationTestReg=new RegExp("^\\s*".concat(e.operationTest,"\\s*$")),e.matchedTest=operationBlockChar+e.nameTest+operationBlockChar,e.matchedTestReg=new RegExp(e.matchedTest,"g"),e.argTest="".concat(e.nameTest,"(?:\\s*").concat(operationBlockChar+e.nameTest+operationBlockChar,")?|").concat(e.numTest,"|").concat(e.operationTest),e.argTestReg=new RegExp("^\\s*(".concat(e.argTest,")\\s*$")),e.opTestReg=new RegExp("^\\s*(".concat(e.allRegex.suffixOperators,")?\\s*(").concat(e.allRegex.operators,")\\s*(").concat(e.allRegex.prefixOperators,")?\\s*(").concat(e.argTest,")\\s*")),e.opIntialTestReg=new RegExp("^\\s*(".concat(e.allRegex.prefixOperators,")?\\s*(").concat(e.argTest,")")),e.opFinalTestReg=new RegExp("^\\s*(".concat(e.allRegex.suffixOperators,")\\s*$")),e.getMatchedString=function(n,t){return n.replace(e.matchedTestReg,(function(e){return t.get(e).match}))},e}},{key:"parse",value:function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.options,o=r.forbiddenChars;t=t instanceof Map?t:new Map,this.__clonedStr=e,this.__realPos=0;for(var a=0;a<o.length;a++)y(e,o[a])&&m("forbidden char "+o[a]);if(e=e.replace(/^\s*$/,(function(){n=new R("")})),n)return n;e=this.__parseBlocks(e,t);for(var i=0;i<r.rulesRegex.length;i++)e=e.replace(r.rulesRegex[i],(function(){}));e=this.__parseOpertors(e,t),this.__parse(e,r,t,{parseBlocks:!1,parseOperators:!1})}},{key:"__parse",value:function(e,n,t){var r,o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if((a=Object.assign({parseBlocks:!0,parseOperators:!0},a)).parseBLocks&&(e=this.__parseBlocks(e,t)),a.parseOperators&&(e=this.__parseBlocks(e,t)),e=e.replace(/^\s*$/,(function(){r=new R("")})),r)return r;if(e=e.replace(new RegExp("^\\s*(##".concat(n.nameTest,"##)\\s*$")),(function(e,n){r=t.get(n).sNode})),r)return r;if(e=e.replace(new RegExp("^\\s*(".concat(n.nameTest,"\\s*\\.\\s*)+(?:(").concat(n.nameTest,")\\s*(##").concat(n.nameTest,"##))\\s*$")),(function(e,a,i,u){var s=t.get(u);if(n.all.prefixOperators.search(new RegExp(" \\(@(".concat(name,"),#(\\d*)\\) ")))>-1){var c=t.get(s),l=new R("prefixOperator",c,{name:name});t.set(name,l)}else if(s.sNode.calls("()")){var f,p=o.parse(a,t);f=new R("implementFunction",s.sNode.args,{name:i}),r=new R(".",[p,f],{dotType:"function",fullName:a+i})}})),r)return r;if(e=e.replace(/^\s*(.*)\.(\$\$[_a-zA-z]+\d*\$\$)\s*$/,(function(e,n,a){e&&(r=new R(".",[o.parse(first,t),new R("id",[],{name:a})],{dotType:"id",extension:e}))})),r)return r;if(e=e.replace(/^\s*(([_a-zA-z]+)\d*)\s*$/,(function(e,n,t){e&&(r=new R(t?"id":"num",[],{value:n}))})),r)return r;if(e=e.replace(/^(-?\d+\.?\d*)|(-?\d*\.?\d+)$/,(function(e,n,t){e&&(r=new R(t?"id":"num",[],{value:n}))})),r)return r;throw new Error("invalid script.\n"+e)}},{key:"__parseBlocks",value:function(e,n,t){for(var r,o=this,a=n.blocks,i=function(e,a){var i=D(),u=r.parser?r.parser.parse(a):o.__parse(a,n,t),s=new R("block",u,{id:r.id,tokenRef:r});return t.set(i,s),i},u=0;u<a.length;u++)r=a[u],e=e.replace(r.regex,i);return e}},{key:"__parseOperators",value:function(e,n,t){var r=!0,o=!1,a=void 0;try{for(var i,u=n.separators[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var s=i.value;if(new RegExp(s.regex).test(e)){var c=this.__get,l=[],f=e.split(s),p=!0,h=!1,g=void 0;try{for(var d,v=f[Symbol.iterator]();!(p=(d=v.next()).done);p=!0){var y=d.value;l.push(this.parse(y,t))}}catch(e){h=!0,g=e}finally{try{p||null==v.return||v.return()}finally{if(h)throw g}}t.set(c,new R("separator",l,{name:s,length:l.length}))}}}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}var b,w="".concat(n.nameTest,"|").concat(n.numTest,"|##").concat(n.nameTest,"##"),x=new RegExp("^\\s*(".concat(n.allRegex.suffixOperators,")?\\s*(").concat(n.allRegex.operators,")\\s*(").concat(n.allRegex.prefixOperators,")?\\s*(").concat(w,")\\s*")),E=new RegExp("^\\s*(".concat(n.allRegex.prefixOperators,")?\\s*(").concat(w,")")),F=new RegExp("^\\s*(".concat(n.allRegex.suffixOperators,")\\s*$")),O="",_={name:null,sn:null};for(e=e.replace(E,(function(e,r,o){if(r){var a=o,i="prefixOperator",u=r;if(isNaN(a)){var s=!1;if(a.replace("##".concat(n.nameTest,"##"),(function(){s=!0})),s){var c=new R(i,t.get(a),{name:u});t.set(a,c),_.sn={name:a,sn:c}}else{var l=D(),f=new R(i,new R("variable",[],{name:a}),{name:u});t.set(l,f),_={name:l,sn:f}}}else{var p=D(),h=new R(i,new R("number",[],{value:parseInt(a)}),{name:u});t.set(p,h),_={name:p,sn:h}}}else{var g=!1;o.replace("##".concat(n.nameTest,"##"),(function(){g=!0})),_=g?{name:o,sn:t.get(o)}:{name:o}}return""}));b!==e;)b=e,e=e.replace(x,(function(r,o,a,i,u){if(a||m("operators","invalid operators",e,null),o)for(var s=0;s<n.suffixOperators.length;s++)if(n.suffixOperators[s].regex.test(o)){var c=_.name,l="suffixOperator",f=o;if(isNaN(c)){var p=!1;if(c.replace("##".concat(n.nameTest,"##"),(function(){p=!0})),p){var h=new R(l,_.sn,{name:f});t.set(c,h),_.sn=h}else{var g=D(),d=new R(l,new R("variable",[],{name:c}),{name:f});t.set(g,d),_={name:g,sn:d}}}else{var v=D(),y=new R(l,new R("number",[],{value:parseInt(c)}),{name:f});t.set(v,y),_={name:v,sn:y}}}if(O+=_.name+" "+a+" ",i){var b=u,w="prefixOperator",x=i;if(isNaN(b)){var E=!1;if(b.replace("##".concat(n.nameTest,"##"),(function(){E=!0})),E){var F=new R(w,t.get(b),{name:x});t.set(b,F),_.sn={name:b,sn:F}}else{var C=D(),T=new R(w,new R("variable",[],{name:b}),{name:x});t.set(C,T),_={name:C,sn:T}}}else{var k=D(),S=new R(w,new R("number",[],{value:parseInt(b)}),{name:x});t.set(k,S),_={name:k,sn:S}}}else{var A=!1;u.replace("##".concat(n.nameTest,"##"),(function(){A=!0})),_=A?{name:u,sn:t.get(u)}:{name:u}}return""}));return""!==e&&""!==(e=e.replace(F,(function(e,r){var o=_.name,a="suffixOperator",i=r;if(isNaN(o)){var u=!1;if(o.replace("##".concat(n.nameTest,"##"),(function(){u=!0})),u){var s=new R(a,_.sn,{name:i});t.set(o,s),_.sn={name:o,sn:s}}else{var c=D(),l=new R(a,new R("variable",[],{name:o}),{name:i});t.set(c,l),_={name:c,sn:l}}}else{var f=D(),p=new R(a,new R("number",[],{value:parseInt(o)}),{name:i});t.set(f,p),_={name:f,sn:p}}return O+=_.name,""})))&&m("operators","invalid suffix operator at the end","",null),O}}])&&H(n.prototype,t),r&&H(n,r),e}();function X(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ee(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(X(this,e),n=Object.assign({parser:"inherit"},n),Object.assign(this,n),!this.opening||!this.closing)throw new Error("you must set the opening and the closing of the block");this.opened=!1,this.num=0}var n,t,r;return n=e,(t=[{key:"id",get:function(){return this._id},set:function(e){e instanceof RegExp?(this._id=e,this.regex=e,this.regexStr=e.source):e instanceof Object?(this._id=e,this.opening=this.id.opening,this.closing=this.id.closing,e.opening&&e.closing&&(e.content=e.content||"all",e.content instanceof RegExp?e.content=e.content.source:"all"===e.content?e.content="(?:.*?|\\s*)*?":e.content=d(e.content),this.regexStr="".concat(d(e.opening),"(").concat(e.content,")").concat(d(e.closing)),this.regex=new RegExp(this.regexStr))):(this._id=e,this.regex=new RegExp(d(e)),this.regexStr=this.regex.source),this.regex.global||(this.regex=new RegExp(this.regex.source,(this.regex.flags||"")+"g"))}},{key:"name",get:function(){return this._name?this._name:this.opening+this.closing},set:function(e){this._name=e}},{key:"content",get:function(){return this._contentTest||"all"},set:function(e){this._contentTest=e}}])&&ee(n.prototype,t),r&&ee(n,r),e}();function te(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function re(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ae={Math:function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._options={autoMultSign:!0,vars:[],nameTest:"[a-zA-Z_]+\\d*",numTest:"\\d+\\.?\\d*|\\d*\\.?\\d+",prefixOperators:[new V({id:"+"}),new V({id:"-"})],suffixOperators:[new L({id:"!"}),new L({id:"deg"}),new L({id:"rad"})],operators:[new Z({id:".",zIndex:11}),new Z({id:"^",zIndex:10}),new Z({id:"**",zIndex:10}),new Z({id:"*",zIndex:9}),new Z({id:"/",zIndex:9}),new Z({id:"mod",zIndex:9}),new Z({id:"+",zIndex:7}),new Z({id:"-",zIndex:7}),new Z({id:">>",zIndex:6}),new Z({id:"<<",zIndex:6}),new Z({id:">=",zIndex:5}),new Z({id:"<=",zIndex:5}),new Z({id:"!=",zIndex:5}),new Z({id:"<",zIndex:5}),new Z({id:">",zIndex:5}),new Z({id:"==",zIndex:5}),new Z({id:"&",zIndex:4}),new Z({id:"band",zIndex:4}),new Z({id:"|",zIndex:4}),new Z({id:"bor",zIndex:4}),new Z({id:"bxor",zIndex:4}),new Z({id:"constrain",zIndex:4}),new Z({id:"in",zIndex:3}),new Z({id:"out",zIndex:3}),new Z({id:"xnor",zIndex:1}),new Z({id:"xor",zIndex:1}),new Z({id:"nand",zIndex:1}),new Z({id:"nor",zIndex:1}),new Z({id:"or",zIndex:1}),new Z({id:"and",zIndex:1}),new Z({id:"||",zIndex:1}),new Z({id:"&&",zIndex:1}),new Z({id:"=",zIndex:0})],separators:[new Y({id:";"}),new Y({id:","})],blocks:[new ne({id:/\(([^(]*?)\)/,opening:"(",closing:")"}),new ne({id:/\{([^{]*?)\}/,opening:"{",closing:"}"}),new ne({id:/\[([^[]*?)\]/,opening:"[",closing:"]"}),new ne({id:/"(.*?|\\")*"/,opening:'"',closing:'"'}),new ne({id:/'(.*?|\\')*'/,opening:"'",closing:"'"})],forbiddenChars:[]},this.options=Object.assign(this._options,n||{})}var n,t,r;return n=e,(t=[{key:"prepareOptions",value:function(e){(e=Object.assign({nameTest:"[_a-zA-Z]+\\d*",numTest:"\\d*\\.?\\d+|\\d+\\.?\\d*",operators:[],suffixOperators:[],prefixOperators:[],separators:[],blocks:[],rules:[],forbiddenChars:[]},e)).forbiddenChars=[].concat(te(e.forbiddenChars),te(b));var n={operators:"",prefixOperators:"",suffixOperators:""},t=function(e){if(e&&e.length>0){for(var n=" ",t=function(t){var r=e[t],o=!1;n.replace(new RegExp("\\(@(".concat(r.regexStr,")#(\\d*)\\)")),(function(n,a,i){return Object.assign(e[t],e[parseInt(i)]),e.splice(parseInt(i),1),o=!0," (@".concat(r.toString(),",#").concat(t,") ")})),o||(n+="(@".concat(r.regexStr,"#").concat(t,")"))},r=0;r<e.length;r++)t(r);return n}};return n.operators=t(e.operators),n.prefixOperators=t(e.prefixOperators),n.suffixOperators=t(e.suffixOperators),e.all=n,(n={operators:"",prefixOperators:"",suffixOperators:""}).operators=(t=function(e){if(0==e.length)return"";if(e&&e.length>0){for(var n="",t=0;t<e.length;t++){var r=e[t];n+="".concat(r.regexStr,"|")}return n.slice(0,-1)}})(e.operators),n.prefixOperators=t(e.prefixOperators),n.suffixOperators=t(e.suffixOperators),e.allRegex=n,e.operators&&(e.operators=e.operators.sort((function(e,n){return-(e.zIndex-n.zIndex)}))),e.blocks={values:e.blocks,openedBlock:null},e.rulesRegex=[],e.rules.forEach((function(n){e.rulesRegex.push(new RegExp(n.getRegex()))})),e.nameTestReg=new RegExp(e.nameTest),e.numTestReg=new RegExp(e.numTest),e.matchedTest="¶\\w+¶",e.matchedTestReg=new RegExp(e.matchedTest,"g"),e.operationTestGrouped="(?:(".concat(e.nameTest,")\\s*)?(")+e.matchedTest+")",e.operationTestGroupedReg=new RegExp("^\\s*".concat(e.operationTestGrouped,"\\s*$")),e.operationTest="(?:".concat(e.nameTest,"\\s*)?")+e.matchedTest,e.operationTestReg=new RegExp("^\\s*".concat(e.operationTest,"\\s*$")),e.argTest="".concat(e.nameTest,"(?:\\s*").concat(e.matchedTest,")?|").concat(e.numTest,"|").concat(e.operationTest),e.argTestReg=new RegExp("^\\s*(".concat(e.argTest,")\\s*$")),e.opTestReg=new RegExp("^\\s*(".concat(e.allRegex.suffixOperators,")?\\s*(").concat(e.allRegex.operators,")\\s*(").concat(e.allRegex.prefixOperators,")?\\s*(").concat(e.argTest,")\\s*")),e.opIntialTestReg=new RegExp("^\\s*(".concat(e.allRegex.prefixOperators,")?\\s*(").concat(e.argTest,")")),e.opFinalTestReg=new RegExp("^\\s*(".concat(e.allRegex.suffixOperators,")\\s*$")),e.getMatchedString=function(n,t){return n.replace(e.matchedTestReg,(function(e){return t.get(e).match}))},e}},{key:"parse",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=this.options;n=n instanceof Map?n:new Map;for(var r=0;r<t.forbiddenChars.length;r++)y(e,t.forbiddenChars[r])&&m("forbiddenSymbol","forbidden symbol.");return this.__parse(e,t,n)}},{key:"__parse",value:function(e,n,t){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o=Object.assign({parseBlocks:!0,parseOperators:!0},o),e=e.replace(/^\s*$/,(function(){r=new R("",[],{match:e})})),r)return r;o.parseBlocks&&(e=this.__parseBlocks(e,n,t)),o.parseOperators&&(e=this.__parseOperators(e,n,t));var a=this.__parseArg(e,n,t);return a.match=a.match||n.getMatchedString(e,t),a}},{key:"__parseBlocks",value:function(e,n,t){for(var r,o,a=this,i=n.blocks,u=function(e,i){var u=D(),s=[];r.parser&&(s="inherit"===r.parser?[a.__parse(i,n,t)]:[r.parser(i)]);var c=new R("block",s,{name:r.name,match:n.getMatchedString(e,t),content:n.getMatchedString(i,t)});return t.set(u,c),o=!1,u},s=0;s<i.values.length;s++)for(r=i.values[s],o=!1;!o;)o=!0,e=e.replace(r.regex,u);return e}},{key:"__parseOperators",value:function(e,n,t){var r=this,o=!0,a=!1,i=void 0;try{for(var u,s=n.separators[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;if(y(e,c.id)){var l=D(),f=[],p=e.split(c),h=!0,g=!1,d=void 0;try{for(var v,b=p[Symbol.iterator]();!(h=(v=b.next()).done);h=!0){var w=v.value;f.push(this.__parse(w,n,t))}}catch(e){g=!0,d=e}finally{try{h||null==b.return||b.return()}finally{if(g)throw d}}return t.set(l,new R("separator",f,{name:c.name,length:f.length,match:n.getMatchedString(e,t)})),l}}}catch(e){a=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}var x="",E=null;e=e.replace(n.opIntialTestReg,(function(e,o,a){if(o){var i=D(),u=new R("prefixOperator",r.__parseArg(a,n,t),{name:o,match:n.getMatchedString(e,t)});t.set(i,u),E=i}else E=a;return""}));for(var F=!1;!F;)F=!0,e=e.replace(n.opTestReg,(function(o,a,i,u,s){if(i||m("operators","invalid operators",e,null),a){var c=D(),l=new R("suffixOperator",r.__parseArg(E,n,t),{name:a,match:n.getMatchedString(E+a,t)});t.set(c,l),E=c}if(x+="".concat(E," ").concat(i," "),u){var f=D(),p=new R("prefixOperator",r.__parseArg(s,n,t),{name:u,match:n.getMatchedString(u+s,t)});t.set(f,p),E=f}else E=s;return F=!1,""}));if(""!==e?""!==(e=e.replace(n.opFinalTestReg,(function(e,o){var a=D(),i=new R("suffixOperator",r.__parseArg(E,n,t),{name:o,match:n.getMatchedString(E+e,t)});return t.set(a,i),x+=a,""})))&&m("operators","invalid suffix operator at the end","",null):x+=E,!(F=n.argTestReg.test(x)))for(var O=0;O<n.operators.length;O++)for(F=!1;!F;)F=!0,y(x,n.operators[O].id)&&(x=x.replace(new RegExp("(".concat(n.argTest,") (").concat(n.operators[O].regexStr,") (").concat(n.argTest,")")),(function(e,o,a,i){var u=r.__parseArg(o,n,t),s=r.__parseArg(i,n,t),c=D();return t.set(c,new R("operator",[u,s],{name:a,match:n.getMatchedString(e,t)})),F=!1,c})));return x}},{key:"__parseArg",value:function(e,n,t){var r;if(e=e.replace(/^\s*(.*)\s*$/,"$1"),isNaN(e)||(r=new R("number",[],{value:parseFloat(e),match:e})),r)return r;if(e=e.replace(n.operationTestGroupedReg,(function(e,o,a){if(r=t.get(a),o&&"block"===r.type&&"()"===r.name)n.vars.find((function(e){return e===o})),r=new R("functionCalling",r.args,{name:o,match:n.getMatchedString(e,t)});else if(o)throw new Error("you have inputted a name (identifier) then an invalid block after it.")})),r)return r;if(e=e.replace(n.nameTestReg,(function(n){r=new R("variable",[],{name:n,match:e})})),r)return r;throw new Error("invalid script.\n"+e)}},{key:"options",get:function(){return this._options},set:function(e){this._options=this.prepareOptions(e)}}])&&re(n.prototype,t),r&&re(n,r),e}(),ProgMath:function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._options={autoMultSign:!0,vars:[],nameTest:"[a-zA-Z_]+\\d*",numTest:"\\d+\\.?\\d*|\\d*\\.?\\d+",prefixOperators:[new V({id:"+"}),new V({id:"-"})],suffixOperators:[new L({id:"!"}),new L({id:"deg"}),new L({id:"rad"})],operators:[new Z({id:"^",zIndex:10}),new Z({id:"*",zIndex:9}),new Z({id:"/",zIndex:9}),new Z({id:"mod",zIndex:9}),new Z({id:"+",zIndex:7}),new Z({id:"-",zIndex:7}),new Z({id:">>",zIndex:6}),new Z({id:"<<",zIndex:6}),new Z({id:">=",zIndex:5}),new Z({id:"<=",zIndex:5}),new Z({id:"!=",zIndex:5}),new Z({id:"<",zIndex:5}),new Z({id:">",zIndex:5}),new Z({id:"==",zIndex:5}),new Z({id:"&",zIndex:4}),new Z({id:"band",zIndex:4}),new Z({id:"|",zIndex:4}),new Z({id:"bor",zIndex:4}),new Z({id:"bxor",zIndex:4}),new Z({id:"constrain",zIndex:4}),new Z({id:"in",zIndex:3}),new Z({id:"out",zIndex:3}),new Z({id:"xnor",zIndex:1}),new Z({id:"xor",zIndex:1}),new Z({id:"nand",zIndex:1}),new Z({id:"nor",zIndex:1}),new Z({id:"or",zIndex:1}),new Z({id:"and",zIndex:1}),new Z({id:"||",zIndex:1}),new Z({id:"&&",zIndex:1}),new Z({id:"=",zIndex:0})],separators:[new Y({id:";"}),new Y({id:","})],blocks:[new ne({id:{opening:"{",closing:"}"}}),new ne({id:{opening:"[",closing:"]"}}),new ne({id:{opening:"(",closing:")"}}),new ne({id:{opening:'"',closing:'"'}}),new ne({id:{opening:"'",closing:"'"}})],forbiddenChars:[]},this.options=n}var n,t,r;return n=e,(t=[{key:"parse",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=this.options;n=n instanceof Map?n:new Map;for(var r=0;r<t.forbiddenChars.length;r++)y(e,t.forbiddenChars[r])&&m("forbiddenSymbol","forbidden symbol.");return e=e.replace(/\s+/g,(function(){return" "})),this.__parse(e,t,n)}},{key:"__parse",value:function(e,n,t){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o=Object.assign({parseBlocks:!0,parseOperators:!0},o),e=e.replace(/^\s*$/,(function(){r=new R("")})),r)return r;if(o.parseBlocks&&(e=this.__parseBlocks(e,n,t)),o.parseOperators&&(e=this.__parseOperators(e,n,t)),e=e.replace(/^\s*(.*)\s*$/,"$1"),isNaN(e)||(r=new R("number",[],{value:parseFloat(e)})),e=e.replace(n.operationTestReg,(function(e){r=t.get(e)})),r)return r;if(e=e.replace(n.nameTestReg,(function(e){r=new R("variable",[],{name:e})})),r)return r;throw new Error("invalid script.\n"+e)}},{key:"__parseBlocks",value:function(e,n,t){for(var r,o=this,a=n.blocks,i=function(e,a){var i=D(),u=new R("block",[o.__parse(a,n,t)],{id:r.id});return t.set(i,u),i},u=0;u<a.values.length;u++)r=a.values[u],e=e.replace(r.regex,i);return e}},{key:"__parseOperators",value:function(e,n,t){var r=!0,o=!1,a=void 0;try{for(var i,u=n.separators[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var s=i.value;if(y(e,s.id)){var c=this.__get,l=[],f=e.split(s),p=!0,h=!1,g=void 0;try{for(var d,v=f[Symbol.iterator]();!(p=(d=v.next()).done);p=!0){var b=d.value;l.push(this.__parse(b,n,t))}}catch(e){h=!0,g=e}finally{try{p||null==v.return||v.return()}finally{if(h)throw g}}t.set(c,new R("separator",l,{name:s.id,length:l.length}))}}}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}var w="",x={name:null,sn:null};e=e.replace(n.opIntialTestReg,(function(e,r,o){if(r){var a=o,i="prefixOperator",u=r;if(isNaN(a)){var s=!1;if(a.replace(n.operationTestReg,(function(){s=!0})),s){var c=new R(i,t.get(a),{name:u});t.set(a,c),x.sn={name:a,sn:c}}else{var l=D(),f=new R(i,new R("variable",[],{name:a}),{name:u});t.set(l,f),x={name:l,sn:f}}}else{var p=D(),h=new R(i,new R("number",[],{value:parseInt(a)}),{name:u});t.set(p,h),x={name:p,sn:h}}}else{var g=!1;o.replace(n.operationTestReg,(function(){g=!0})),x=g?{name:o,sn:t.get(o)}:{name:o}}return""}));for(var E=!1;!E;)E=!0,e=e.replace(n.opTestReg,(function(r,o,a,i,u){if(a||m("operators","invalid operators",e,null),o){var s=x,c="suffixOperator",l=o;if(isNaN(s)){var f=!1;if(s.replace(n.operationTestReg,(function(){f=!0})),f){var p=new R(c,x.sn,{name:l});t.set(s,p),x.sn=p}else{var h=D(),g=new R(c,new R("variable",[],{name:s}),{name:l});t.set(h,g),x={name:h,sn:g}}}else{var d=D(),v=new R(c,new R("number",[],{value:parseInt(s)}),{name:l});t.set(d,v),x={name:d,sn:v}}}if(w+="".concat(x.name," ").concat(a," "),i){var y=u,b="prefixOperator",F=i;if(isNaN(y)){var O=!1;if(y.replace(n.operationTestReg,(function(){O=!0})),O){var _=new R(b,t.get(y),{name:F});t.set(y,_),x.sn={name:y,sn:_}}else{var C=D(),T=new R(b,new R("variable",[],{name:y}),{name:F});t.set(C,T),x={name:C,sn:T}}}else{var k=D(),S=new R(b,new R("number",[],{value:parseInt(y)}),{name:F});t.set(k,S),x={name:k,sn:S}}}else{var A=!1;u.replace(n.operationTestReg,(function(){A=!0})),x=A?{name:u,sn:t.get(u)}:{name:u}}return E=!1,""}));""!==e?""!==(e=e.replace(n.opFinalTestReg,(function(e,r){var o=x.name,a="suffixOperator",i=r;if(isNaN(o)){var u=!1;if(o.replace(n.operationTestReg,(function(){u=!0})),u){var s=new R(a,x.sn,{name:i});t.set(o,s),x.sn={name:o,sn:s}}else{var c=D(),l=new R(a,new R("variable",[],{name:o}),{name:i});t.set(c,l),x={name:c,sn:l}}}else{var f=D(),p=new R(a,new R("number",[],{value:parseInt(o)}),{name:i});t.set(f,p),x={name:f,sn:p}}return w+=x.name,""})))&&m("operators","invalid suffix operator at the end","",null):w+=x.name;for(var F=0;F<n.operators.length;F++)for(E=!1;!E;)E=!0,y(w,n.operators[F].id)&&(w=w.replace(new RegExp("(".concat(n.argTest,")\\s*(").concat(n.operators[F].regexStr,")\\s*(").concat(n.argTest,")")),(function(e,r,o,a){var i,u;if(isNaN(r)){var s=!1;r.replace(n.operationTestReg,(function(){i=t.get(r),s=!0})),s||(i=new R("variable",[],{name:r}))}else i=new R("number",[],{value:parseInt(r)});if(isNaN(a)){var c=!1;a.replace(n.operationTestReg,(function(){u=t.get(a),c=!0})),c||(u=new R("variable",[],{name:a}))}else u=new R("number",[],{value:parseInt(a)});var l=D();return t.set(l,new R("operator",[i,u],{name:o})),E=!1,l})));return w}},{key:"options",get:function(){return this._options},set:function(e){e=Object.assign(this._options,e),prepareOptions(e)}}])&&oe(n.prototype,t),r&&oe(n,r),e}()},ie={Operator:Z,SuffixOperator:L,PrefixOperator:V,Separator:Y,Block:ne};function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ce(e,n){return!n||"object"!==ue(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,n){return(fe=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var pe=function(e){function n(e,t){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),0==e.length)throw new Error("Sequence musn\t be void.");return ce(this,le(n).call(this,"AnyOf",-1,e,t))}var t,r,o;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&fe(e,n)}(n,e),t=n,(r=[{key:"getRegex",value:function(e){e=e||{num:0,increase:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.num+=e,this}},this.index=e.num;var n="";return this.childrenRules.forEach((function(t){n+=t.getRegex(e.increase())+"|"})),"(".concat(n,")")}},{key:"parse",value:function(e,n){var t=this,r=n||e[this.index+1],o=[];this.blockState&&(r=r.replace(this.rootParser.matchesTest,(function(e,n,r){return t.rootParser.matches[n][r].str})));var a=!0,i=!1,u=void 0;try{for(var s,c=this.childrenRules[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;if(e.values[l.index]){o.push(l.parse(e));break}}}catch(e){i=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw u}}return new R(this.name,o,{match:r})}}])&&se(t.prototype,r),o&&se(t,o),n}(E);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,n){return!n||"object"!==he(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e,n){return(me=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var ye=function(e){function n(e){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),de(this,ve(n).call(this,"Anything",0,[],e))}var t,r,o;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&me(e,n)}(n,e),t=n,(r=[{key:"getRegex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e=e||{num:0,increase:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.num+=e,this}},this.index=e.num,"(.*?)"}},{key:"parse",value:function(e,n){var t=this,r=n||e[this.index+1],o=[];return this.blockState&&(r=r.replace(this.rootParser.matchesTest,(function(e,n,r){return t.rootParser.matches[n][r].str}))),this.parser&&o.push(this.parser.parse(r)),new R(this.name,o,{match:r})}}])&&ge(t.prototype,r),o&&ge(t,o),n}(E);function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function we(e,n){return!n||"object"!==De(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,n){return(Ee=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var Fe=function(e){function n(e,t){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),t=Object.assign({spaced:!0},t),we(this,xe(n).call(this,"Repeat",1,[e],t))}var t,r,o;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&Ee(e,n)}(n,e),t=n,(r=[{key:"getRegex",value:function(e){e=e||{num:0,increase:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.num+=e,this}},this.index=e.num;var n,t=isNaN(this.length)?"+":"{".concat(this.length,"}"),r=this.childrenRules[0].getRegex(e.increase());return this.repeatedRegex=new RegExp(r,"g"),n=this.spaced?"(?:".concat(r,"\\s*)").concat(t):"".concat(r).concat(t),this.regex=n,"(".concat(n,")")}},{key:"parse",value:function(e,n){var t=this,r=n||e[this.index+1],o=[];return r.replace(this.repeatedRegex,(function(n){return o.push(t.childrenRules[0].parse(e,n)),""})),this.blockState&&(r=r.replace(this.rootParser.matchesTest,(function(e,n,r){return t.rootParser.matches[n][r].str}))),new R(this.name,o,{match:r})}}])&&be(t.prototype,r),o&&be(t,o),n}(E);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,n){return!n||"object"!==Oe(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Te(e,n){return(Te=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var ke=function(e){function n(e,t){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),t=Object.assign({spaced:!0},t),0==e.length)throw new Error("Sequence musn\t be void.");return _e(this,Ce(n).call(this,"Sequence",-1,e,t))}var t,r,o;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&Te(e,n)}(n,e),t=n,(r=[{key:"getRegex",value:function(e){var n=this;e=e||{num:0,increase:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.num+=e,this}},this.index=e.num;var t="";return this.childrenRules.forEach((function(r){t+=r.getRegex(e.increase()),n.spaced&&(t+="\\s*")})),this.spaced&&(t=t.slice(0,-"\\s*".length)),this.regex=t,"(".concat(t,")")}},{key:"parse",value:function(e,n){var t=this,r=n||e[this.index+1],o=[],a=!0,i=!1,u=void 0;try{for(var s,c=this.childrenRules[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;o.push(l.parse(e))}}catch(e){i=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw u}}return this.blockState&&(r=r.replace(this.rootParser.matchesTest,(function(e,n,r){return t.rootParser.matches[n][r].str}))),new R(this.name,o,{match:r})}}])&&Re(t.prototype,r),o&&Re(t,o),n}(E),Se={Node:R,Parser:z,OperatorsParser:J,CustomParsers:ae,TOKENS:{STRING:'"(?:[^"]|\\")*"',NUMBER:"\\d+.\\d*|\\d*.\\d+",BRACKETS:"\\{.*?\\}",ROUND_BRACKETS:"\\(.*?\\)",CURLEY_BRACKETS:"\\{.*?\\}",SQUARE_BRACKETS:"\\[.*?\\]"},Tokens:ie,Rules:{AnyOf:pe,AnyThing:ye,Block:A,Repeat:Fe,Sequence:ke,Rule:E}};n.default=Se}])}));
//# sourceMappingURL=MagicalParser.js.map